<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>æåŒ—é˜³å…‰æ¤ç‰©ç§æ¤å›­ - v4.22 é€Ÿæˆç‰ˆ</title>
  <style>
    :root {
      --primary: #4CAF50;
      --primary-dark: #388E3C;
      --primary-light: #81C784;
      --field-bg: #c9b08c;
      --plot-empty: #d2b48c;
      --plot-growing: #a8e6a1;
      --plot-mature: #ffeb3b;
      --plot-wilted: #a9a9a9;
      --plot-infested: #ff6b6b;
      --warning: #FF9800;
      --warning-dark: #F57C00;
      --gray-light: #f5f5f5;
      --gray: #e0e0e0;
      --text-dark: #333;
      --text-muted: #666;
      --shadow-sm: 0 2px 4px rgba(0,0,0,0.05);
      --shadow: 0 2px 8px rgba(0,0,0,0.1);
      --shadow-lg: 0 4px 12px rgba(0,0,0,0.15);
      --radius-sm: 4px;
      --radius: 8px;
      --radius-lg: 12px;
      --transition: all 0.2s ease;
      /* æ–°å¢åœŸåœ°ç­‰çº§é¢œè‰² */
      --land-normal: #d2b48c;
      --land-black: #424242;
      --land-red: #b71c1c;
      --land-gold: #ffd700;
    }
    
    * { 
      margin: 0; 
      padding: 0; 
      box-sizing: border-box; 
      font-family: "Microsoft YaHei", "PingFang SC", sans-serif; 
    }
    
    body { 
      background: linear-gradient(135deg, #e8f5e9 0%, #f1f8e9 100%); 
      padding: 16px; 
      color: var(--text-dark); 
      position: relative; 
      min-height: 100vh;
    }
    
    .container { 
      max-width: 900px; 
      margin: 0 auto; 
    }
    
    /* å¤´éƒ¨ä¼˜åŒ– */
    header {
      text-align: center; 
      margin-bottom: 16px;
      background: white; 
      padding: 16px; 
      border-radius: var(--radius-lg); 
      box-shadow: var(--shadow);
      position: relative;
      overflow: hidden;
    }
    
    header::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 4px;
      background: linear-gradient(90deg, var(--primary), var(--warning), var(--primary));
    }
    
    h1 { 
      color: var(--primary); 
      margin-bottom: 8px; 
      font-size: 28px; 
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    
    header > div {
      color: var(--text-muted);
      font-size: 14px;
    }
    
    /* ç»Ÿè®¡é¢æ¿ä¼˜åŒ– */
    .stats {
      display: flex; 
      flex-wrap: wrap; 
      gap: 12px; 
      background: white; 
      padding: 16px;
      border-radius: var(--radius); 
      margin-bottom: 16px; 
      justify-content: space-around; 
      font-size: 15px;
      box-shadow: var(--shadow);
      align-items: center;
    }
    
    .stat-item {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 8px 12px;
      background: var(--gray-light);
      border-radius: var(--radius-sm);
      min-width: 100px;
      justify-content: center;
      position: relative;
    }
    
    .stat-item span {
      font-weight: bold;
      color: var(--primary-dark);
      /* æ•°å­—å˜åŒ–åŠ¨ç”» */
      transition: all 0.3s ease;
    }
    
    .stat-item span.animate {
      animation: numberPop 0.5s ease;
    }
    
    /* å†œç”°æ ‡é¢˜æ ä¼˜åŒ– */
    .field-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 12px;
      flex-wrap: wrap;
      gap: 8px;
      background: white;
      padding: 12px 16px;
      border-radius: var(--radius);
      box-shadow: var(--shadow-sm);
    }
    
    .field-title {
      font-size: 20px;
      font-weight: bold;
      color: var(--primary-dark);
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    .field-weather {
      background: #fff3cd; 
      border: 1px solid #ffeaa7; 
      border-radius: var(--radius-sm);
      padding: 6px 12px; 
      font-weight: bold; 
      color: #856404;
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 4px;
      transition: var(--transition);
    }
    
    .field-weather.change {
      animation: weatherPulse 0.8s ease infinite alternate;
    }
    
    .field-achievement {
      background: #e8f5e9; 
      border: 1px solid #a5d6a7; 
      border-radius: var(--radius-sm);
      padding: 6px 12px; 
      font-weight: bold; 
      color: #2e7d32;
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 4px;
      position: relative;
    }
    
    /* æ–°å¢ï¼šåœŸåœ°ç­‰çº§æ˜¾ç¤º */
    .field-land-level {
      background: linear-gradient(135deg, var(--land-normal) 0%, #e6d2b8 100%);
      border: 1px solid #8b6f4e;
      border-radius: var(--radius-sm);
      padding: 6px 12px; 
      font-weight: bold; 
      color: #333;
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 4px;
    }
    
    /* ç§°å·è¿›åº¦æ¡ */
    .achievement-progress {
      position: absolute;
      bottom: 0;
      left: 0;
      height: 2px;
      background: var(--primary);
      border-radius: 1px;
      transition: var(--transition);
    }
    
    /* åœ°å—ç½‘æ ¼ä¼˜åŒ– */
    .field-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 8px;
      margin-bottom: 20px;
    }
    
    /* åœ°å—æ ·å¼ä¼˜åŒ– - é€‚é…åœŸåœ°ç­‰çº§ï¼ˆæ ¸å¿ƒä¿®å¤ï¼šå¼ºåˆ¶å®½é«˜+é»˜è®¤æ˜¾ç¤ºï¼‰ */
    .plot {
      aspect-ratio: 1;
      border: 2px solid #8b6f4e;
      border-radius: var(--radius);
      cursor: pointer;
      display: flex !important; /* å¼ºåˆ¶æ˜¾ç¤ºï¼Œé¿å…è¢«éšè— */
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      text-align: center;
      padding: 8px;
      position: relative;
      overflow: hidden;
      transition: var(--transition);
      background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.343-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%238b6f4e' fill-opacity='0.1' fill-rule='evenodd'/%3E%3C/svg%3E");
      min-width: 100px; /* å¼ºåˆ¶æœ€å°å®½åº¦ï¼Œç¡®ä¿ç§»åŠ¨ç«¯ä¹Ÿèƒ½æ˜¾ç¤º */
      min-height: 100px; /* å¼ºåˆ¶æœ€å°é«˜åº¦ï¼Œé¿å…é«˜åº¦ä¸º0 */
    }
    
    /* é”å®šåœ°å—æ ·å¼å¢å¼ºï¼ˆç¡®ä¿èƒ½çœ‹è§ï¼‰ */
    .plot.locked {
      background: #555 !important;
      color: #aaa !important;
      cursor: not-allowed;
      opacity: 0.8 !important; /* æé«˜ä¸é€æ˜åº¦ï¼Œé¿å…å¤ªæ·¡çœ‹ä¸è§ */
      border: 2px dashed #888 !important;
    }
    
    /* ç©ºåœ°å—æ ·å¼å¢å¼º */
    .plot.empty {
      border: 2px solid #8b6f4e !important;
    }
    
    .plot:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow);
    }
    
    /* æˆç†Ÿåœ°å—é—ªçƒæé†’ */
    .plot.mature {
      animation: matureFlash 1s infinite alternate;
    }
    
    /* ä¸åŒåœŸåœ°ç­‰çº§çš„ç©ºåœ°æ ·å¼ */
    .plot.empty.normal { background: linear-gradient(135deg, var(--land-normal) 0%, #e6d2b8 100%); }
    .plot.empty.black { background: linear-gradient(135deg, var(--land-black) 0%, #616161 100%); color: white; }
    .plot.empty.red { background: linear-gradient(135deg, var(--land-red) 0%, #d32f2f 100%); color: white; }
    .plot.empty.gold { background: linear-gradient(135deg, var(--land-gold) 0%, #ffed4e 100%); color: #333; }
    
    /* ä¸åŒåœŸåœ°ç­‰çº§çš„ç”Ÿé•¿ä¸­æ ·å¼ */
    .plot.growing.normal { background: linear-gradient(135deg, var(--plot-growing) 0%, #c8e6c9 100%); }
    .plot.growing.black { background: linear-gradient(135deg, #66bb6a 0%, #43a047 100%); color: white; }
    .plot.growing.red { background: linear-gradient(135deg, #81c784 0%, #66bb6a 100%); color: white; }
    .plot.growing.gold { background: linear-gradient(135deg, #a5d6a7 0%, #81c784 100%); color: #333; }
    
    .plot.mature { background: linear-gradient(135deg, var(--plot-mature) 0%, #fff59d 100%); }
    .plot.wilted { background: linear-gradient(135deg, var(--plot-wilted) 0%, #c0c0c0 100%); color: #555; }
    .plot.infested { background: linear-gradient(135deg, var(--plot-infested) 0%, #ff8a80 100%); color: white; }
    
    @keyframes growPulse {
      0% { transform: scale(1); }
      100% { transform: scale(1.03); }
    }
    
    @keyframes infestBlink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.8; }
    }
    
    @keyframes wiltShake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-1px); }
      75% { transform: translateX(1px); }
    }
    
    @keyframes matureFlash {
      0% { box-shadow: 0 0 5px var(--plot-mature); }
      100% { box-shadow: 0 0 15px var(--plot-mature); }
    }
    
    @keyframes weatherPulse {
      0% { transform: scale(1); }
      100% { transform: scale(1.05); }
    }
    
    @keyframes numberPop {
      0% { transform: scale(1); }
      50% { transform: scale(1.2); }
      100% { transform: scale(1); }
    }
    
    /* é¢æ¿æ ·å¼ä¼˜åŒ– */
    .panel {
      background: white; 
      padding: 16px; 
      border-radius: var(--radius);
      margin-bottom: 20px; 
      box-shadow: var(--shadow);
      transition: var(--transition);
    }
    
    .panel:hover {
      box-shadow: var(--shadow-lg);
    }
    
    .panel h3 {
      color: var(--primary-dark);
      margin-bottom: 12px;
      font-size: 18px;
      display: flex;
      align-items: center;
      gap: 6px;
      padding-bottom: 8px;
      border-bottom: 1px solid var(--gray);
    }
    
    /* æŒ‰é’®æ ·å¼ä¼˜åŒ– - å¢å¼ºäº¤äº’ */
    button {
      padding: 8px 16px; 
      margin: 4px 2px; 
      background: var(--primary);
      color: white; 
      border: none; 
      border-radius: var(--radius-sm); 
      cursor: pointer; 
      font-size: 15px;
      transition: var(--transition);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      position: relative;
      overflow: hidden;
    }
    
    button::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      background: rgba(255,255,255,0.2);
      border-radius: 50%;
      transform: translate(-50%, -50%);
      transition: width 0.6s ease, height 0.6s ease;
    }
    
    button:hover::after {
      width: 200px;
      height: 200px;
    }
    
    button:hover {
      background: var(--primary-dark);
      transform: translateY(-1px);
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    button:active {
      transform: translateY(0);
      box-shadow: 0 1px 2px rgba(0,0,0,0.1);
    }
    
    button.warning {
      background: var(--warning);
    }
    
    button.warning:hover {
      background: var(--warning-dark);
    }
    
    button.secondary {
      background: #607D8B;
    }
    
    button.secondary:hover {
      background: #455A64;
    }
    
    /* æ–°å¢ï¼šåœŸåœ°æ“ä½œæŒ‰é’®æ ·å¼ */
    button.land-expand {
      background: #2196F3;
    }
    button.land-expand:hover {
      background: #1976D2;
    }
    button.land-upgrade {
      background: #9C27B0;
    }
    button.land-upgrade:hover {
      background: #7B1FA2;
    }
    
    /* ä¸€é”®æ“ä½œæŒ‰é’®ç»„ */
    .batch-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 12px;
    }
    
    .hidden { display: none; }
    
    /* ä¼˜åŒ–åçš„é€šçŸ¥ç³»ç»Ÿ */
    .notification-container {
      position: fixed;
      bottom: 20px;
      right: 20px;
      z-index: 9999;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    
    .notification {
      background: rgba(51, 51, 51, 0.95);
      color: white;
      padding: 16px 20px;
      border-radius: var(--radius);
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
      display: flex;
      align-items: center;
      gap: 12px;
      min-width: 300px;
      max-width: 400px;
      border-left: 4px solid var(--primary);
      animation: slideIn 0.3s ease forwards, fadeOut 0.5s ease 3.5s forwards;
      transform: translateX(120%);
      opacity: 0;
    }
    
    .notification.success {
      border-left-color: var(--primary);
      background: rgba(76, 175, 80, 0.95);
    }
    
    .notification.warning {
      border-left-color: var(--warning);
      background: rgba(255, 152, 0, 0.95);
    }
    
    .notification.error {
      border-left-color: #F44336;
      background: rgba(244, 67, 54, 0.95);
    }
    
    .notification.info {
      border-left-color: #2196F3;
      background: rgba(33, 150, 243, 0.95);
    }
    
    .notification.mature {
      border-left-color: #FFEB3B;
      background: rgba(255, 235, 59, 0.95);
      color: #333;
      animation: slideIn 0.3s ease forwards, fadeOut 0.5s ease 5s forwards;
    }
    
    .notification-icon {
      font-size: 24px;
      min-width: 24px;
      text-align: center;
    }
    
    .notification-content {
      flex: 1;
    }
    
    .notification-title {
      font-weight: bold;
      margin-bottom: 2px;
      font-size: 15px;
    }
    
    .notification-message {
      font-size: 14px;
      opacity: 0.9;
    }
    
    @keyframes slideIn {
      0% {
        transform: translateX(120%);
        opacity: 0;
      }
      100% {
        transform: translateX(0);
        opacity: 1;
      }
    }
    
    @keyframes fadeOut {
      0% {
        opacity: 1;
        transform: translateX(0);
      }
      100% {
        opacity: 0;
        transform: translateX(20px);
      }
    }
    
    /* éœ‡åŠ¨åé¦ˆåŠ¨ç”» */
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-4px); }
      75% { transform: translateX(4px); }
    }
    
    .shake {
      animation: shake 0.5s ease;
    }
    
    /* ç§å­ä»“åº“ä¼˜åŒ– */
    #seedInventory {
      display: flex; 
      gap: 10px; 
      flex-wrap: wrap;
    }
    
    #seedInventory .seed-card {
      background: var(--gray-light);
      border-radius: var(--radius);
      padding: 10px 12px;
      font-size: 14px;
      cursor: pointer;
      transition: var(--transition);
      border: 2px solid transparent;
      min-width: 90px;
      text-align: center;
    }
    
    #seedInventory .seed-card.selected {
      background: #fff3e0;
      border-color: var(--warning);
      box-shadow: 0 0 0 2px rgba(255,152,0,0.2), 0 2px 8px rgba(255,152,0,0.15);
      transform: translateY(-2px);
    }
    
    #seedInventory .seed-card:hover {
      background: #e0f2f1;
      transform: translateY(-2px);
      box-shadow: var(--shadow-sm);
    }
    
    .seed-count {
      font-weight: bold;
      color: var(--primary-dark);
    }
    
    /* åœ°å—æŒ‰é’®ä¼˜åŒ– */
    .plot-button-container {
  display: flex;
  flex-direction: column;
  gap: 2px; /* ä»4pxæ”¹ä¸º2pxï¼Œå‡å°æŒ‰é’®é—´è· */
  margin-top: 4px; /* å‡å°é¡¶éƒ¨å¤–è¾¹è· */
  width: 100%;
  align-items: center;
}
    
    .plot-button {
  background: var(--primary);
  color: white;
  border: none;
  border-radius: var(--radius-sm);
  padding: 2px 5px; /* ä»5px 10pxæ”¹ä¸º2px 5pxï¼Œå¤§å¹…ç¼©å°å†…è¾¹è· */
  font-size: 11px; /* ä»13pxæ”¹ä¸º11pxï¼Œå‡å°å­—ä½“ */
  cursor: pointer;
  z-index: 10;
  white-space: nowrap;
  box-shadow: 0 1px 3px rgba(0,0,0,0.2);
  width: 90%; /* ä»100%æ”¹ä¸º90%ï¼Œå‡å°å®½åº¦ */
  text-align: center;
  transition: var(--transition);
}
    
    .plot-button:hover {
  background: var(--primary-dark);
  transform: scale(1.02);
}

/* ä¿ç•™åŸæœ‰æŒ‰é’®ç±»å‹çš„èƒŒæ™¯è‰²æ ·å¼ */
.plot-button.spray {
  background: #F44336;
}

.plot-button.spray:hover {
  background: #D32F2F;
}

.plot-button.water {
  background: #2196F3;
}

.plot-button.water:hover {
  background: #1976D2;
}

.plot-button.fertilize {
  background: #9C27B0;
}

.plot-button.fertilize:hover {
  background: #7B1FA2;
}
    
    /* åœ°å—å†…å®¹æ ·å¼ */
    .time-label {
      font-size: 10px;
      color: var(--text-muted);
      margin-top: 2px;
    }
    
    .plot-content {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100%;
      width: 100%;
      position: relative;
      z-index: 5;
    }
    
    .crop-icon-container {
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 4px;
    }
    
    .crop-icon {
      font-size: 24px;
    }
    
    .status-icon {
      position: absolute;
      font-size: 16px;
      top: -6px;
      right: -6px;
      background: rgba(255, 255, 255, 0.9);
      border-radius: 50%;
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      border: 2px solid #ccc;
      box-shadow: 0 1px 2px rgba(0,0,0,0.2);
    }
    
    .status-icon.wilted {
      background: rgba(169, 169, 169, 0.9);
      color: white;
      border-color: #888;
    }
    
    .status-icon.infested {
      background: rgba(255, 107, 107, 0.9);
      color: white;
      border-color: #e53935;
    }
    
    .status-icon.dehydrated {
      background: rgba(33, 150, 243, 0.9);
      color: white;
      border-color: #1565c0;
    }
    
    .yield-info {
      font-size: 9px;
      color: var(--text-muted);
      margin-top: 2px;
    }
    
    /* å¯ç”¨åœ°å—æç¤º */
    .unlocked-plot-count {
      background: var(--gray-light);
      padding: 8px 12px;
      border-radius: var(--radius-sm);
      font-weight: bold;
      color: var(--primary-dark);
      margin-top: 8px;
      text-align: center;
      font-size: 14px;
      box-shadow: var(--shadow-sm);
    }
    
    /* æ‰“å¡é¢æ¿æ ·å¼ */
    .checkin-panel {
      margin-bottom: 20px;
    }
    
    .checkin-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }
    
    .checkin-stats {
      display: flex;
      gap: 16px;
      margin-bottom: 12px;
      flex-wrap: wrap;
    }
    
    .checkin-stat {
      background: var(--gray-light);
      padding: 8px 16px;
      border-radius: var(--radius-sm);
      font-size: 14px;
    }
    
    .checkin-stat strong {
      color: var(--primary-dark);
      font-size: 16px;
    }
    
    .checkin-history {
      max-height: 200px;
      overflow-y: auto;
      border: 1px solid var(--gray);
      border-radius: var(--radius-sm);
      padding: 8px;
      margin-top: 12px;
    }
    
    .checkin-record {
      padding: 8px;
      border-bottom: 1px solid var(--gray);
      display: flex;
      justify-content: space-between;
      font-size: 14px;
    }
    
    .checkin-record:last-child {
      border-bottom: none;
    }
    
    .checkin-date {
      color: var(--text-muted);
    }
    
    .checkin-reward {
      color: var(--primary-dark);
      font-weight: bold;
    }
    
    /* æ–°æ‰‹å¼•å¯¼å¼¹çª— */
    .guide-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.7);
      z-index: 99999;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    
    .guide-content {
      background: white;
      border-radius: var(--radius-lg);
      padding: 24px;
      max-width: 500px;
      width: 100%;
      box-shadow: var(--shadow-lg);
    }
    
    .guide-content h3 {
      color: var(--primary-dark);
      margin-bottom: 16px;
      text-align: center;
    }
    
    .guide-content ul {
      margin-left: 20px;
      margin-bottom: 20px;
      line-height: 1.6;
    }
    
    .guide-content li {
      margin-bottom: 8px;
    }
    
    .guide-content button {
      display: block;
      width: 100%;
      padding: 10px;
      font-size: 16px;
    }
    
    /* å“åº”å¼é€‚é… */
    @media (max-width: 768px) {
      .field-grid {
        grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
      }
      
      .stats {
        justify-content: center;
      }
      
      .stat-item {
        min-width: unset;
        width: 45%;
      }
      
      .field-header {
        justify-content: center;
      }
      
      .field-weather, .field-achievement, .field-land-level {
        width: 100%;
        justify-content: center;
      }
      
      .notification {
        min-width: unset;
        width: calc(100% - 40px);
      }
    }
    
    @media (max-width: 480px) {
      .stat-item {
        width: 100%;
      }
      
      button {
        width: 100%;
        margin: 4px 0;
      }
      
      .plot {
        padding: 4px;
      }
      
      .crop-icon {
        font-size: 20px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>&#127793; æåŒ—é˜³å…‰æ¤ç‰©ç§æ¤å›­ - v4.22</h1>
      <div>&#9989; æ€¥é€Ÿæ¨¡å¼ Â· &#9989; æ‰©åœ°åŠŸèƒ½ Â· &#9989; åŒç§°å·ç³»ç»Ÿ Â· &#9989; æ¯æ—¥æ‰“å¡</div>
    </header>
 
    <!-- ä¼˜åŒ–åçš„ç»Ÿè®¡é¢æ¿ -->
    <div class="stats">
      <div class="stat-item">ç­‰çº§: <span id="level">1</span></div>
      <div class="stat-item">ç»éªŒ: <span id="exp">0</span>/<span id="nextLevelExp">50</span></div>
      <div class="stat-item">&#127793;ç§æ¤æ•°: <span id="plantedCount">0</span></div>
      <div class="stat-item">&#128176;é‡‘å¸: <span id="gold">200</span></div>
      <div class="stat-item">æ€è™«å‰‚: <span id="pesticide">5</span></div>
      <div class="stat-item">è‚¥æ–™: <span id="fertilizer">5</span></div>
      <div class="stat-item">åœŸåœ°ç­‰çº§: <span id="landLevelText">æ™®é€šåœŸåœ°</span></div>
    </div>
 
    <!-- æ–°å¢ï¼šåœŸåœ°æ“ä½œé¢æ¿ -->
    <div class="panel">
      <h3>&#127799; åœŸåœ°ç®¡ç†</h3>
      <button id="expandLandBtn" class="land-expand">ğŸŒ¾ å€ŸåŠ©æ‰˜é©¬æ–¯ä¹‹åŠ›æ‰©åœ° (æ¶ˆè€—100é‡‘å¸)</button>
      <button id="upgradeLandBtn" class="land-upgrade">ğŸ”¨ å€ŸåŠ©æåŒ—ä¹‹åŠ›ç¿»æ–°åœŸåœ°</button>
      <p style="margin-top: 8px; color: var(--text-muted); font-size: 14px;">
        åœŸåœ°ç­‰çº§æ•ˆæœï¼ˆé€Ÿæˆç‰ˆåŠ æˆæ›´é«˜ï¼‰ï¼š<br>
        â€¢ é»‘åœŸåœ°ï¼šæ”¶ç›Š+30%ï¼Œæˆç†Ÿæ—¶é—´-20%<br>
        â€¢ çº¢åœŸåœ°ï¼šæ”¶ç›Š+60%ï¼Œæˆç†Ÿæ—¶é—´-30%<br>
        â€¢ é‡‘åœŸåœ°ï¼šæ”¶ç›Š+120%ï¼Œæˆç†Ÿæ—¶é—´-40%
      </p>
    </div>
 
    <!-- æ–°å¢ï¼šæ¯æ—¥æ‰“å¡é¢æ¿ -->
    <div class="panel checkin-panel">
      <div class="checkin-header">
        <h3>&#128197; æ¯æ—¥æ‰“å¡ï¼ˆå¥–åŠ±ç¿»å€ï¼‰</h3>
        <button id="checkinBtn" class="warning">ç«‹å³æ‰“å¡</button>
      </div>
      
      <div class="checkin-stats">
        <div class="checkin-stat">è¿ç»­æ‰“å¡: <strong id="consecutiveDays">0</strong> å¤©</div>
        <div class="checkin-stat">æ€»æ‰“å¡æ¬¡æ•°: <strong id="totalCheckins">0</strong> æ¬¡</div>
        <div class="checkin-stat">æœ€åæ‰“å¡: <strong id="lastCheckinTime">ä»æœª</strong></div>
      </div>
      
      <div>
        <h4 style="margin-bottom: 8px; font-size: 15px; color: var(--text-muted);">æ‰“å¡å¥–åŠ±è§„åˆ™ï¼ˆé€Ÿæˆç‰ˆï¼‰ï¼š</h4>
        <ul style="margin-left: 20px; margin-bottom: 12px; color: var(--text-muted); font-size: 14px;">
          <li>é¦–æ¬¡æ‰“å¡ï¼šé‡‘å¸Ã—100 + å°éº¦ç§å­Ã—5</li>
          <li>è¿ç»­1-3å¤©ï¼šé‡‘å¸Ã—60 + éšæœºç§å­Ã—2</li>
          <li>è¿ç»­4-7å¤©ï¼šé‡‘å¸Ã—100 + è‚¥æ–™Ã—2 + æ€è™«å‰‚Ã—2</li>
          <li>è¿ç»­7å¤©ä»¥ä¸Šï¼šé‡‘å¸Ã—200 + å‘æ—¥è‘µç§å­Ã—4 + è‚¥æ–™Ã—4</li>
        </ul>
      </div>
      
      <div class="checkin-history">
        <div style="text-align: center; color: var(--text-muted); font-size: 13px; margin-bottom: 8px;">æ‰“å¡å†å²è®°å½•</div>
        <div id="checkinHistoryList">æš‚æ— æ‰“å¡è®°å½•</div>
      </div>
    </div>
 
    <!-- å•†åº—ï¼ˆä»·æ ¼å‡åŠï¼‰ -->
    <div class="panel">
      <h3>&#128722; å•†åº—ï¼ˆé€Ÿæˆç‰ˆåŠä»·ï¼‰</h3>
      <button onclick="buySeed('å°éº¦', 5)">ä¹°å°éº¦ (5é‡‘å¸)</button>
      <button onclick="buySeed('ç‰ç±³', 10)">ä¹°ç‰ç±³ (10é‡‘å¸)</button>
      <button onclick="buySeed('åœŸè±†', 8)">ä¹°åœŸè±† (8é‡‘å¸)</button>
      <button onclick="buySeed('ç•ªèŒ„', 9)">ä¹°ç•ªèŒ„ (9é‡‘å¸)</button>
      <button onclick="buySeed('å‘æ—¥è‘µ', 12)">ä¹°å‘æ—¥è‘µ (12é‡‘å¸)</button>
      <button onclick="buyItem('pesticide', 4)" class="secondary">&#129713; æ€è™«å‰‚ (4é‡‘å¸)</button>
      <button onclick="buyItem('fertilizer', 5)" class="secondary">&#127807; è‚¥æ–™ (5é‡‘å¸)</button>
    </div>
 
    <!-- ä¸€é”®æ“ä½œé¢æ¿ -->
    <div class="panel">
      <h3>&#9889; æ‰¹é‡æ“ä½œ</h3>
      <div class="batch-actions">
        <button onclick="harvestAll()" class="warning">&#128260; ä¸€é”®æ”¶è·</button>
        <button onclick="waterAll()" class="secondary">&#128167; ä¸€é”®æµ‡æ°´</button>
        <button onclick="sprayAll()" class="secondary">&#129454; ä¸€é”®æ€è™«</button>
        <button onclick="fertilizeAll()" class="secondary">&#127807; ä¸€é”®æ–½è‚¥</button>
      </div>
    </div>
 
    <!-- ç§å­ä»“åº“ -->
    <div class="panel">
      <h3>&#129530; æˆ‘çš„ç§å­åº“</h3>
      <div id="seedInventory"></div>
      <p style="margin-top: 12px; color: var(--text-muted);">å½“å‰é€‰ä¸­ï¼š<span id="selectedSeedDisplay">æ— </span></p>
    </div>
 
    <!-- å†œç”°æ ‡é¢˜ + åŒç§°å· + å¤©æ°” + åœŸåœ°ç­‰çº§ -->
    <div class="field-header">
      <div class="field-title">&#127806; å†œç”°</div>
      <div class="field-achievement" id="currentPlantAchievement">
        &#127793; åˆèŠ½èŒåŠ¨
        <div class="achievement-progress" id="plantAchievementProgress" style="width: 0%"></div>
      </div>
      <div class="field-achievement" id="currentGoldAchievement">
        &#128176; é’é“œ
        <div class="achievement-progress" id="goldAchievementProgress" style="width: 0%"></div>
      </div>
      <div class="field-weather" id="weatherDisplay">&#127780;&#65039; å½“å‰å¤©æ°”ï¼šæ™´å¤©</div>
      <div class="field-land-level" id="landLevelDisplay">ğŸŒ¾ æ™®é€šåœŸåœ°</div>
    </div>
 
    <div id="farm-land" class="field-grid"></div>
    <div class="unlocked-plot-count" id="unlockedPlotCount">å¯ç”¨åœ°å—: 10/50</div>
 
    <!-- å­˜æ¡£æ“ä½œ -->
    <div class="panel">
      <button onclick="saveGame()" class="secondary">&#128190; ä¿å­˜</button>
      <button onclick="loadGame()" class="secondary">&#128194; è¯»å–</button>
      <button onclick="clearSave()" class="warning">&#128465;&#65039; æ¸…é™¤å­˜æ¡£</button>
    </div>
  </div>
 
  <!-- æ–°æ‰‹å¼•å¯¼å¼¹çª— -->
  <div class="guide-modal" id="guideModal" style="display: none;">
    <div class="guide-content">
      <h3>ğŸŒ¾ æåŒ—é˜³å…‰æ¤ç‰©ç§æ¤å›­ - æ–°æ‰‹å¼•å¯¼</h3>
      <ul>
        <li>âœ… é€Ÿæˆç‰ˆä½œç‰©ç”Ÿé•¿æ—¶é—´å¤§å¹…ç¼©çŸ­ï¼ˆ10-30ç§’æˆç†Ÿï¼‰</li>
        <li>âœ… åˆå§‹é‡‘å¸/é“å…·æ›´å¤šï¼Œå•†åº—åŠä»·ï¼Œæ‰©åœ°/å‡çº§æˆæœ¬æ›´ä½</li>
        <li>âœ… ç‚¹å‡»ç§å­åº“é€‰æ‹©ç§å­ï¼Œå†ç‚¹å‡»ç©ºåœ°ç§æ¤</li>
        <li>âœ… ä½œç‰©æˆç†Ÿä¼šé—ªçƒæé†’ï¼Œä¸€é”®æ“ä½œæ›´ä¾¿æ·</li>
        <li>âœ… æ¯æ—¥æ‰“å¡å¥–åŠ±ç¿»å€ï¼Œå¿«é€Ÿç§¯ç´¯èµ„æº</li>
        <li>âœ… åœŸåœ°å‡çº§åæ”¶ç›Šæ›´é«˜ã€ç”Ÿé•¿æ›´å¿«</li>
      </ul>
      <button onclick="document.getElementById('guideModal').style.display='none'">å¼€å§‹æ¸¸æˆ ğŸ®</button>
    </div>
  </div>
 
  <!-- é€šçŸ¥å®¹å™¨ -->
  <div class="notification-container" id="notificationContainer"></div>
 
  <script>
    // ===== ä½œç‰©å®šä¹‰ï¼ˆé€Ÿæˆç‰ˆï¼šç”Ÿé•¿æ—¶é—´æ”¹ä¸ºç§’çº§ï¼‰=====
    const CROPS = {
      å°éº¦:  { icon: '&#127806;', growthTime: 10000, reward: 15 },  // 10ç§’
      ç‰ç±³:  { icon: '&#127805;', growthTime: 15000, reward: 30 },  // 15ç§’
      åœŸè±†:  { icon: '&#129364;', growthTime: 12000, reward: 25 },  // 12ç§’
      ç•ªèŒ„:  { icon: '&#127813;', growthTime: 18000, reward: 28 },  // 18ç§’
      å‘æ—¥è‘µ:{ icon: '&#127803;', growthTime: 25000, reward: 40 }   // 25ç§’
    };
    
    // ===== åœŸåœ°ç­‰çº§é…ç½®ï¼ˆé€Ÿæˆç‰ˆï¼šæˆæœ¬é™ä½ï¼ŒåŠ æˆæ›´é«˜ï¼‰=====
    const LAND_LEVELS = {
      0: { name: 'æ™®é€šåœŸåœ°', color: 'normal', rewardRate: 1.0, timeRate: 1.0, upgradeCost: 200 },
      1: { name: 'é»‘åœŸåœ°', color: 'black', rewardRate: 1.3, timeRate: 0.8, upgradeCost: 800 },
      2: { name: 'çº¢åœŸåœ°', color: 'red', rewardRate: 1.6, timeRate: 0.7, upgradeCost: 2000 },
      3: { name: 'é‡‘åœŸåœ°', color: 'gold', rewardRate: 2.2, timeRate: 0.6, upgradeCost: 0 } // æœ€é«˜ç­‰çº§
    };
    
    const SAVE_KEY = 'sunshineFarm_savedate';
    
    // ===== å¤©æ°”ç³»ç»Ÿï¼ˆå¸¦è‡ªå®šä¹‰æ¦‚ç‡ï¼Œé€Ÿæˆç‰ˆï¼šç¾å®³æ¦‚ç‡é™ä½ï¼‰=====
    const WEATHERS = [
      { name: 'æ™´å¤©', icon: '&#9728;&#65039;', effect: 'normal', weight: 75 },
      { name: 'é›¨å¤©', icon: '&#127783;&#65039;', effect: 'rain', weight: 20 },
      { name: 'å¹²æ—±', icon: '&#128293;', effect: 'drought', weight: 3 },
      { name: 'è™«ç¾', icon: '&#128027;', effect: 'pest_outbreak', weight: 2 }
    ];
    
    let currentWeather = WEATHERS[0];
    let selectedSeed = null;
    
    // ===== ç­‰çº§é…ç½® =====
    const LEVEL_CONFIG = [
      { level: 1, exp: 0, nextExp: 50, unlockPlots: 10 },
      { level: 2, exp: 50, nextExp: 100, unlockPlots: 12 },
      { level: 3, exp: 100, nextExp: 200, unlockPlots: 15 },
      { level: 4, exp: 200, nextExp: 350, unlockPlots: 18 },
      { level: 5, exp: 350, nextExp: 500, unlockPlots: 22 },
      { level: 6, exp: 500, nextExp: 800, unlockPlots: 25 },
      { level: 7, exp: 800, nextExp: 1200, unlockPlots: 30 },
      { level: 8, exp: 1200, nextExp: 2000, unlockPlots: 35 },
      { level: 9, exp: 2000, nextExp: 3000, unlockPlots: 40 },
      { level: 10, exp: 3000, nextExp: 0, unlockPlots: 50 }
    ];
 
    function getRandomWeather() {
      const totalWeight = WEATHERS.reduce((sum, w) => sum + w.weight, 0);
      let random = Math.random() * totalWeight;
       
      for (const weather of WEATHERS) {
        if (random < weather.weight) {
          return weather;
        }
        random -= weather.weight;
      }
      return WEATHERS[0];
    }
    
    function shuffleArray(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
    }
 
    function changeWeather() {
      let newWeather;
      do {
        newWeather = getRandomWeather();
      } while (newWeather.name === currentWeather.name && WEATHERS.length > 1);
 
      currentWeather = newWeather;
      const weatherEl = document.getElementById('weatherDisplay');
      weatherEl.innerHTML = `${currentWeather.icon} å½“å‰å¤©æ°”ï¼š${currentWeather.name}`;
      weatherEl.classList.add('change');
      setTimeout(() => weatherEl.classList.remove('change'), 1000);
      
      notify(`&#127782;&#65039; å¤©æ°”å˜ä¸ºï¼š${currentWeather.name}`, 'info', 'å¤©æ°”å˜åŒ–');
    }
 
    document.getElementById('weatherDisplay').innerHTML = 
      `${currentWeather.icon} å½“å‰å¤©æ°”ï¼š${currentWeather.name}`;
    
    setInterval(changeWeather, 60000); // å¤©æ°”å˜åŒ–é¢‘ç‡åŠ å¿«ï¼Œ1åˆ†é’Ÿä¸€æ¬¡
 
    // ===== é‡‘å¸ç§°å·ç³»ç»Ÿï¼ˆ9çº§ï¼‰=====
    const GOLD_TITLES = [
      { name: '&#128176; é’é“œ', minGold: 0 },
      { name: '&#128176; ç™½é“¶', minGold: 100 },
      { name: '&#128176; é»„é‡‘', minGold: 200 },
      { name: '&#128176; é“‚é‡‘', minGold: 400 },
      { name: '&#128176; é’»çŸ³', minGold: 800 },
      { name: '&#128176; æ˜Ÿè€€', minGold: 1600 },
      { name: '&#128176; å·…å³°', minGold: 3200 },
      { name: '&#128176; å¤§äº¨', minGold: 6400 },
      { name: '&#128176; å·¨å¯Œ', minGold: 15000 }
    ];
 
    // ===== ç§æ¤æ•°é‡ç§°å·ç³»ç»Ÿï¼ˆ30çº§ï¼‰=====
    const PLANT_TITLES = [
      { name: '&#127793; åˆèŠ½èŒåŠ¨', minPlants: 6 },
      { name: '&#127793; é’è‹—æ–°ç§€', minPlants: 16 },
      { name: '&#127793; ç»¿é‡è€•è€˜è€…', minPlants: 31 },
      { name: '&#127793; ç”°ç•¦å®ˆæŠ¤è€…', minPlants: 51 },
      { name: '&#127793; æ²ƒåœŸè¡Œè€…', minPlants: 101 },
      { name: '&#127793; ä¸°æ”¶åˆæˆè€…', minPlants: 201 },
      { name: '&#127793; ç»¿è«ç­‘æ¢¦å¸ˆ', minPlants: 301 },
      { name: '&#127793; ç”°å›­äº¤å“è€…', minPlants: 501 },
      { name: '&#127793; å¤§åœ°ç»‡é”¦äºº', minPlants: 800 },
      { name: '&#127793; åƒç•¦ä¹‹ä¸»', minPlants: 1200 },
      { name: '&#127793; ç»¿æ´²ç¼”é€ è€…', minPlants: 1800 },
      { name: '&#127793; ä¸°é¥¶é¢†ä¸»', minPlants: 2500 },
      { name: '&#127793; ç”Ÿæ€å›­ä¸', minPlants: 3500 },
      { name: '&#127793; ç”°å›­è¯—äºº', minPlants: 5000 },
      { name: '&#127793; å¤§åœ°å¯¼å¸ˆ', minPlants: 7000 },
      { name: '&#127793; ä¸‡äº©è€•è€˜è€…', minPlants: 10000 },
      { name: '&#127793; ç»¿é‡å®—å¸ˆ', minPlants: 15000 },
      { name: '&#127793; ä¸°é¥¶åœ£å¾’', minPlants: 20000 },
      { name: '&#127793; ç”Ÿæ€å…ˆçŸ¥', minPlants: 30000 },
      { name: '&#127793; ç”°å›­å…ˆçŸ¥', minPlants: 40000 },
      { name: '&#127793; ç»¿é‡ä¹‹ç¥', minPlants: 50000 },
      { name: '&#127793; ä¸°é¥¶ä¹‹ç¥', minPlants: 60000 },
      { name: '&#127793; å¤§åœ°ä¹‹çµ', minPlants: 70000 },
      { name: '&#127793; ç”°å›­åœ£ä¸»', minPlants: 80000 },
      { name: '&#127793; ä¸‡é¡·å†œçš‡', minPlants: 90000 },
      { name: '&#127793; äº”è°·ä¸°ç™»ç‹', minPlants: 100000 },
      { name: '&#127793; ç”°å›­åˆ›ä¸–ç¥', minPlants: 120000 },
      { name: '&#127793; ä¸‡ç‰©ç”Ÿå…»è€…', minPlants: 150000 },
      { name: '&#127793; å¤§åœ°æ¯ç¥', minPlants: 180000 },
      { name: '&#127793; ä¸°é¥¶ä¹‹æº', minPlants: 200000 }
    ];
 
    // ===== æ¸¸æˆçŠ¶æ€ï¼ˆé€Ÿæˆç‰ˆï¼šåˆå§‹èµ„æºæ›´å¤šï¼Œè§£é”åœ°å—æ›´å¤šï¼‰=====
    let gameState = {
      level: 1,
      exp: 0,
      gold: 200,
      pesticide: 5,
      fertilizer: 5,
      seeds: { å°éº¦: 10, ç‰ç±³: 8, åœŸè±†: 6, ç•ªèŒ„: 4, å‘æ—¥è‘µ: 2 },
      totalHarvest: 0,
      totalPlanted: 0,
      totalEarnedGold: 200,
      lands: {
        farm: initPlots(50) // æœ€å¤§åœ°å—æ•°æå‡åˆ°50
      },
      // æ‰©åœ°ç›¸å…³ï¼ˆé€Ÿæˆç‰ˆï¼šåˆå§‹è§£é”10å—åœ°ï¼‰
      unlockedPlots: 10, // åˆå§‹è§£é”10å—åœ°
      maxPlots: 50,      // æœ€å¤§åœ°å—æ•°
      // åœŸåœ°ç­‰çº§ç›¸å…³
      landLevel: 0,     // 0æ™®é€š/1é»‘/2çº¢/3é‡‘
      // æ‰“å¡ç›¸å…³çŠ¶æ€
      checkInRecords: [],      // æ‰“å¡è®°å½• [{time: æ—¶é—´æˆ³, date: æ—¥æœŸ, reward: å¥–åŠ±æè¿°}]
      lastCheckInDate: '',     // æœ€åæ‰“å¡æ—¥æœŸ YYYY-MM-DD
      consecutiveCheckInDays: 0, // è¿ç»­æ‰“å¡å¤©æ•°
      hasSeenGuide: false      // æ˜¯å¦çœ‹è¿‡æ–°æ‰‹å¼•å¯¼
    };
 
    // åˆå§‹åŒ–åœ°å—
    function initPlots(count) {
      const plots = [];
      for (let i = 0; i < count; i++) {
        plots.push({
          crop: null,
          plantedAt: null,
          lastWatered: null,
          wiltedAt: null,
          infestedAt: null,
          totalInfestedTime: 0,
          totalWiltedTime: 0,
          infestedStartTime: null,
          wiltedStartTime: null,
          hasEverBeenInfested: false,
          hasEverBeenWilted: false,
          fertilized: false
        });
      }
      return plots;
    }
 
    // åŠ è½½å­˜æ¡£
    const saved = localStorage.getItem(SAVE_KEY);
    if (saved) {
      try {
        const loadedState = JSON.parse(saved);
        if (loadedState && typeof loadedState.gold === 'number') {
          // å…¼å®¹æ—§å­˜æ¡£ï¼Œè¡¥å……æ–°å­—æ®µ + å¼ºåˆ¶å…œåº•
          gameState = {
            ...gameState,
            ...loadedState,
            exp: loadedState.exp || 0,
            unlockedPlots: (loadedState.unlockedPlots || 10), // å…œåº•10å—
            maxPlots: (loadedState.maxPlots || 50),
            landLevel: (loadedState.landLevel || 0),
            checkInRecords: (loadedState.checkInRecords || []),
            lastCheckInDate: (loadedState.lastCheckInDate || ''),
            consecutiveCheckInDays: (loadedState.consecutiveCheckInDays || 0),
            hasSeenGuide: (loadedState.hasSeenGuide || false),
            // ç¡®ä¿lands.farmæœ‰å€¼
            lands: {
              farm: loadedState.lands?.farm || initPlots(50)
            }
          };
        }
      } catch (e) {
        console.warn('å­˜æ¡£æŸåï¼Œä½¿ç”¨é»˜è®¤å€¼', e);
        // å­˜æ¡£æŸåæ—¶é‡ç½®ä¸ºé»˜è®¤ï¼Œç¡®ä¿åœ°å—èƒ½æ˜¾ç¤º
        gameState.unlockedPlots = 10;
        gameState.lands.farm = initPlots(50);
      }
    }
 
    // ===== å¢å¼ºç‰ˆé€šçŸ¥å‡½æ•°ï¼ˆæ–°å¢æˆç†Ÿæé†’ï¼‰=====
    let notificationId = 0;
    function notify(message, type = 'success', title = '', vibrate = true) {
      // éœ‡åŠ¨åé¦ˆï¼ˆæµè§ˆå™¨æ”¯æŒæ—¶ï¼‰
      if (vibrate && navigator.vibrate) {
        navigator.vibrate(100);
      }
      
      const container = document.getElementById('notificationContainer');
      const id = `notification-${notificationId++}`;
      
      // è‡ªåŠ¨ç”Ÿæˆæ ‡é¢˜
      if (!title) {
        switch (type) {
          case 'success': title = 'æ“ä½œæˆåŠŸ'; break;
          case 'warning': title = 'æ¸©é¦¨æç¤º'; break;
          case 'error': title = 'æ“ä½œå¤±è´¥'; break;
          case 'info': title = 'ç³»ç»Ÿé€šçŸ¥'; break;
          case 'mature': title = 'ğŸ‰ ä½œç‰©æˆç†Ÿ'; break;
        }
      }
      
      // å›¾æ ‡æ˜ å°„
      const icons = {
        success: 'âœ…',
        warning: 'âš ï¸',
        error: 'âŒ',
        info: 'â„¹ï¸',
        mature: 'ğŸ¾'
      };
      
      // åˆ›å»ºé€šçŸ¥å…ƒç´ 
      const notification = document.createElement('div');
      notification.id = id;
      notification.className = `notification ${type}`;
      notification.innerHTML = `
        <div class="notification-icon">${icons[type] || icons.success}</div>
        <div class="notification-content">
          <div class="notification-title">${title}</div>
          <div class="notification-message">${message}</div>
        </div>
      `;
      
      // ç‚¹å‡»é€šçŸ¥å¯æ‰‹åŠ¨å…³é—­
      notification.onclick = () => {
        notification.style.animation = 'fadeOut 0.3s ease forwards';
        setTimeout(() => container.removeChild(notification), 300);
      };
      
      container.appendChild(notification);
      
      // è‡ªåŠ¨å…³é—­ï¼ˆæˆç†Ÿé€šçŸ¥ä¿ç•™5ç§’ï¼Œå…¶ä»–4ç§’ï¼‰
      const closeTime = type === 'mature' ? 5000 : 4000;
      setTimeout(() => {
        if (document.getElementById(id)) {
          notification.style.animation = 'fadeOut 0.5s ease forwards';
          setTimeout(() => {
            if (document.getElementById(id)) {
              container.removeChild(notification);
            }
          }, 500);
        }
      }, closeTime);
    }
 
    function formatTime(ms) {
      if (ms < 0) ms = 0;
      const s = Math.floor(ms / 1000);
      if (s < 60) return `${s}s`;
      const m = Math.floor(s / 60);
      const remainingS = s % 60;
      return `${m}m${remainingS}s`;
    }
    
    // æ ¼å¼åŒ–æ—¥æœŸæ—¶é—´
    function formatDateTime(timestamp) {
      const date = new Date(timestamp);
      const year = date.getFullYear();
      const month = String(date.getMonth() + 1).padStart(2, '0');
      const day = String(date.getDate()).padStart(2, '0');
      const hour = String(date.getHours()).padStart(2, '0');
      const minute = String(date.getMinutes()).padStart(2, '0');
      return `${year}-${month}-${day} ${hour}:${minute}`;
    }
    
    // è·å–å½“å‰æ—¥æœŸ YYYY-MM-DD
    function getCurrentDate() {
      const date = new Date();
      const year = date.getFullYear();
      const month = String(date.getMonth() + 1).padStart(2, '0');
      const day = String(date.getDate()).padStart(2, '0');
      return `${year}-${month}-${day}`;
    }
 
    // ===== ç­‰çº§å‡çº§å‡½æ•° =====
    function levelUpCheck() {
      const currentLevelCfg = LEVEL_CONFIG.find(cfg => cfg.level === gameState.level);
      if (!currentLevelCfg || currentLevelCfg.nextExp === 0) return;
      
      if (gameState.exp >= currentLevelCfg.nextExp) {
        gameState.level++;
        const nextLevelCfg = LEVEL_CONFIG.find(cfg => cfg.level === gameState.level) || currentLevelCfg;
        
        // å‡çº§å¥–åŠ±
        gameState.gold += 100 * gameState.level;
        gameState.pesticide += 2;
        gameState.fertilizer += 2;
        
        // è§£é”æ›´å¤šåœ°å—
        if (nextLevelCfg.unlockPlots > gameState.unlockedPlots) {
          gameState.unlockedPlots = nextLevelCfg.unlockPlots;
          updateUnlockedPlotCount();
        }
        
        // å‡çº§é€šçŸ¥
        notify(`ğŸŠ æ­å–œå‡çº§åˆ°${gameState.level}çº§ï¼
å¥–åŠ±ï¼šé‡‘å¸Ã—${100 * gameState.level} + æ€è™«å‰‚Ã—2 + è‚¥æ–™Ã—2
è§£é”åœ°å—æ•°ï¼š${gameState.unlockedPlots}`, 'success', 'ç­‰çº§æå‡');
        
        // æ›´æ–°UI
        renderStats();
      }
    }
    
    // ===== å¢åŠ ç»éªŒå‡½æ•° =====
    function addExp(amount) {
      gameState.exp += amount;
      const expEl = document.getElementById('exp');
      expEl.classList.add('animate');
      setTimeout(() => expEl.classList.remove('animate'), 500);
      levelUpCheck();
      renderStats();
    }
 
    // ===== æ‰©åœ°åŠŸèƒ½ï¼ˆé€Ÿæˆç‰ˆï¼šæˆæœ¬é™ä½ï¼‰=====
    function expandLand() {
      const expandCost = 100 + (gameState.unlockedPlots - 10) * 20; // é€Ÿæˆç‰ˆï¼šæ‰©åœ°æˆæœ¬æ›´ä½
      
      if (gameState.unlockedPlots >= gameState.maxPlots) {
        return notify('å·²æ‰©è‡³æœ€å¤§åœ°å—æ•°ï¼ˆ50å—ï¼‰ï¼Œæ— æ³•ç»§ç»­æ‰©åœ°ï¼', 'warning', 'æ‰©åœ°å¤±è´¥');
      }
      
      if (gameState.gold < expandCost) {
        return notify(`é‡‘å¸ä¸è¶³ï¼æ‰©åœ°éœ€è¦${expandCost}é‡‘å¸`, 'error', 'æ‰©åœ°å¤±è´¥');
      }
      
      // æ‰£é™¤é‡‘å¸ï¼Œæ‰©åœ°
      gameState.gold -= expandCost;
      gameState.unlockedPlots += 1;
      
      // å¢åŠ ç»éªŒ
      addExp(20);
      
      // æ›´æ–°UI
      renderStats();
      renderField();
      updateUnlockedPlotCount();
      
      // æç¤º
      notify(`å€ŸåŠ©æ‰˜é©¬æ–¯ä¹‹åŠ›ï¼Œå·²ä¸ºæ‚¨æ‰©å……1å—åœŸåœ°ï¼å½“å‰å¯ç”¨åœ°å—ï¼š${gameState.unlockedPlots}/${gameState.maxPlots}`, 
             'success', 'æ‰©åœ°æˆåŠŸ');
    }
    
    // ===== åœŸåœ°å‡çº§åŠŸèƒ½ =====
    function upgradeLand() {
      const currentLevel = gameState.landLevel;
      const nextLevel = currentLevel + 1;
      
      // æ£€æŸ¥æ˜¯å¦å·²è¾¾æœ€é«˜ç­‰çº§
      if (!LAND_LEVELS[nextLevel] || LAND_LEVELS[nextLevel].upgradeCost === 0) {
        return notify('å·²è¾¾æœ€é«˜åœŸåœ°ç­‰çº§ï¼ˆé‡‘åœŸåœ°ï¼‰ï¼Œæ— æ³•ç»§ç»­å‡çº§ï¼', 'warning', 'å‡çº§å¤±è´¥');
      }
      
      const upgradeCost = LAND_LEVELS[      // ===== åœŸåœ°å‡çº§åŠŸèƒ½ï¼ˆç»­ï¼‰=====
      nextLevel].upgradeCost;
      
      // æ£€æŸ¥é‡‘å¸æ˜¯å¦è¶³å¤Ÿ
      if (gameState.gold < upgradeCost) {
        return notify(`é‡‘å¸ä¸è¶³ï¼å‡çº§${LAND_LEVELS[nextLevel].name}éœ€è¦${upgradeCost}é‡‘å¸`, 'error', 'å‡çº§å¤±è´¥');
      }
      
      // æ‰£é™¤é‡‘å¸ï¼Œå‡çº§åœŸåœ°
      gameState.gold -= upgradeCost;
      gameState.landLevel = nextLevel;
      const newLandLevel = LAND_LEVELS[nextLevel];
      
      // å‡çº§å¥–åŠ±
      gameState.pesticide += 5;
      gameState.fertilizer += 5;
      addExp(100);
      
      // æ›´æ–°UI
      updateLandLevelDisplay();
      renderStats();
      renderField(); // é‡æ–°æ¸²æŸ“åœ°å—ä»¥åº”ç”¨æ–°çš„åœŸåœ°ç­‰çº§æ ·å¼
      
      // æç¤º
      notify(`ğŸ”¨ å€ŸåŠ©æåŒ—ä¹‹åŠ›ï¼ŒåœŸåœ°å·²å‡çº§ä¸º${newLandLevel.name}ï¼
æ•ˆæœï¼šæ”¶ç›ŠÃ—${newLandLevel.rewardRate}ï¼Œæˆç†Ÿæ—¶é—´Ã—${newLandLevel.timeRate}
å¥–åŠ±ï¼šæ€è™«å‰‚Ã—5 + è‚¥æ–™Ã—5 + ç»éªŒÃ—100`, 'success', 'åœŸåœ°å‡çº§æˆåŠŸ');
    }
    
    // ===== æ›´æ–°åœŸåœ°ç­‰çº§æ˜¾ç¤º =====
    function updateLandLevelDisplay() {
      const landLevel = LAND_LEVELS[gameState.landLevel];
      document.getElementById('landLevelText').textContent = landLevel.name;
      document.getElementById('landLevelDisplay').innerHTML = `ğŸŒ¾ ${landLevel.name}`;
      document.getElementById('landLevelDisplay').style.background = `linear-gradient(135deg, var(--land-${landLevel.color}) 0%, ${
        landLevel.color === 'normal' ? '#e6d2b8' : 
        landLevel.color === 'black' ? '#616161' : 
        landLevel.color === 'red' ? '#d32f2f' : '#ffed4e'
      }) 100%)`;
    }
    
    // ===== æ‰“å¡åŠŸèƒ½å®ç° =====
    function checkIn() {
      const today = getCurrentDate();
      
      // æ£€æŸ¥æ˜¯å¦å·²æ‰“å¡
      if (gameState.lastCheckInDate === today) {
        return notify('ä»Šæ—¥å·²æ‰“å¡ï¼Œè¯·å‹¿é‡å¤æ‰“å¡ï¼', 'warning', 'æ‰“å¡å¤±è´¥');
      }
      
      // è®¡ç®—è¿ç»­æ‰“å¡å¤©æ•°
      let newConsecutiveDays = 1;
      if (gameState.lastCheckInDate) {
        const lastDate = new Date(gameState.lastCheckInDate);
        const todayDate = new Date(today);
        const diffTime = Math.abs(todayDate - lastDate);
        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
        
        if (diffDays === 1) {
          newConsecutiveDays = gameState.consecutiveCheckInDays + 1;
        } else {
          newConsecutiveDays = 1; // æ–­ç­¾ï¼Œé‡ç½®ä¸º1å¤©
        }
      }
      
      // è®¡ç®—æ‰“å¡å¥–åŠ±ï¼ˆé€Ÿæˆç‰ˆå¥–åŠ±ç¿»å€ï¼‰
      let rewardGold = 0;
      let rewardSeeds = {};
      let rewardPesticide = 0;
      let rewardFertilizer = 0;
      let rewardDesc = '';
      
      if (gameState.checkInRecords.length === 0) {
        // é¦–æ¬¡æ‰“å¡
        rewardGold = 100;
        rewardSeeds = { å°éº¦: 5 };
        rewardDesc = 'é‡‘å¸Ã—100 + å°éº¦ç§å­Ã—5';
      } else if (newConsecutiveDays <= 3) {
        // è¿ç»­1-3å¤©
        rewardGold = 60;
        const randomSeed = Object.keys(CROPS)[Math.floor(Math.random() * Object.keys(CROPS).length)];
        rewardSeeds = { [randomSeed]: 2 };
        rewardDesc = `é‡‘å¸Ã—60 + ${randomSeed}ç§å­Ã—2`;
      } else if (newConsecutiveDays <= 7) {
        // è¿ç»­4-7å¤©
        rewardGold = 100;
        rewardPesticide = 2;
        rewardFertilizer = 2;
        rewardDesc = 'é‡‘å¸Ã—100 + è‚¥æ–™Ã—2 + æ€è™«å‰‚Ã—2';
      } else {
        // è¿ç»­7å¤©ä»¥ä¸Š
        rewardGold = 200;
        rewardSeeds = { å‘æ—¥è‘µ: 4 };
        rewardPesticide = 4;
        rewardFertilizer = 4;
        rewardDesc = 'é‡‘å¸Ã—200 + å‘æ—¥è‘µç§å­Ã—4 + è‚¥æ–™Ã—4 + æ€è™«å‰‚Ã—4';
      }
      
      // å‘æ”¾å¥–åŠ±
      gameState.gold += rewardGold;
      if (rewardPesticide > 0) gameState.pesticide += rewardPesticide;
      if (rewardFertilizer > 0) gameState.fertilizer += rewardFertilizer;
      
      // å‘æ”¾ç§å­å¥–åŠ±
      for (const [seed, count] of Object.entries(rewardSeeds)) {
        if (!gameState.seeds[seed]) gameState.seeds[seed] = 0;
        gameState.seeds[seed] += count;
      }
      
      // æ›´æ–°æ‰“å¡çŠ¶æ€
      gameState.lastCheckInDate = today;
      gameState.consecutiveCheckInDays = newConsecutiveDays;
      
      // è®°å½•æ‰“å¡è®°å½•
      const checkInRecord = {
        time: Date.now(),
        date: today,
        reward: rewardDesc
      };
      gameState.checkInRecords.unshift(checkInRecord);
      if (gameState.checkInRecords.length > 30) {
        gameState.checkInRecords = gameState.checkInRecords.slice(0, 30); // åªä¿ç•™æœ€è¿‘30æ¡
      }
      
      // å¢åŠ ç»éªŒ
      addExp(50);
      
      // æ›´æ–°UI
      updateCheckInUI();
      renderStats();
      renderSeedInventory();
      
      // æç¤º
      notify(`ğŸ‰ æ‰“å¡æˆåŠŸï¼è¿ç»­æ‰“å¡${newConsecutiveDays}å¤©
è·å¾—å¥–åŠ±ï¼š${rewardDesc}`, 'success', 'æ¯æ—¥æ‰“å¡');
    }
    
    // ===== æ›´æ–°æ‰“å¡UI =====
    function updateCheckInUI() {
      document.getElementById('consecutiveDays').textContent = gameState.consecutiveCheckInDays;
      document.getElementById('totalCheckins').textContent = gameState.checkInRecords.length;
      document.getElementById('lastCheckinTime').textContent = gameState.lastCheckInDate || 'ä»æœª';
      
      // æ›´æ–°æ‰“å¡å†å²
      const historyList = document.getElementById('checkinHistoryList');
      if (gameState.checkInRecords.length === 0) {
        historyList.innerHTML = 'æš‚æ— æ‰“å¡è®°å½•';
        return;
      }
      
      historyList.innerHTML = gameState.checkInRecords.map(record => `
        <div class="checkin-record">
          <span class="checkin-date">${formatDateTime(record.time)}</span>
          <span class="checkin-reward">${record.reward}</span>
        </div>
      `).join('');
    }
    
    // ===== ç§°å·ç³»ç»Ÿæ›´æ–°å‡½æ•° =====
    function updatePlantTitle() {
      let currentTitle = PLANT_TITLES[0];
      let progress = 0;
      
      // æ‰¾åˆ°å½“å‰ç§°å·
      for (let i = PLANT_TITLES.length - 1; i >= 0; i--) {
        if (gameState.totalPlanted >= PLANT_TITLES[i].minPlants) {
          currentTitle = PLANT_TITLES[i];
          break;
        }
      }
      
      // è®¡ç®—è¿›åº¦
      const nextTitleIndex = PLANT_TITLES.findIndex(t => t.minPlants > currentTitle.minPlants);
      if (nextTitleIndex !== -1) {
        const nextTitle = PLANT_TITLES[nextTitleIndex];
        progress = (gameState.totalPlanted - currentTitle.minPlants) / (nextTitle.minPlants - currentTitle.minPlants);
      } else {
        progress = 1; // æœ€é«˜ç§°å·
      }
      
      // é™åˆ¶è¿›åº¦0-1
      progress = Math.max(0, Math.min(1, progress));
      
      // æ›´æ–°UI
      document.getElementById('currentPlantAchievement').innerHTML = `
        ${currentTitle.name}
        <div class="achievement-progress" id="plantAchievementProgress" style="width: ${progress * 100}%"></div>
      `;
    }
    
    function updateGoldTitle() {
      let currentTitle = GOLD_TITLES[0];
      let progress = 0;
      
      // æ‰¾åˆ°å½“å‰ç§°å·
      for (let i = GOLD_TITLES.length - 1; i >= 0; i--) {
        if (gameState.totalEarnedGold >= GOLD_TITLES[i].minGold) {
          currentTitle = GOLD_TITLES[i];
          break;
        }
      }
      
      // è®¡ç®—è¿›åº¦
      const nextTitleIndex = GOLD_TITLES.findIndex(t => t.minGold > currentTitle.minGold);
      if (nextTitleIndex !== -1) {
        const nextTitle = GOLD_TITLES[nextTitleIndex];
        progress = (gameState.totalEarnedGold - currentTitle.minGold) / (nextTitle.minGold - currentTitle.minGold);
      } else {
        progress = 1; // æœ€é«˜ç§°å·
      }
      
      // é™åˆ¶è¿›åº¦0-1
      progress = Math.max(0, Math.min(1, progress));
      
      // æ›´æ–°UI
      document.getElementById('currentGoldAchievement').innerHTML = `
        ${currentTitle.name}
        <div class="achievement-progress" id="goldAchievementProgress" style="width: ${progress * 100}%"></div>
      `;
    }
    
    // ===== æ›´æ–°å¯ç”¨åœ°å—æ•°æ˜¾ç¤º =====
    function updateUnlockedPlotCount() {
      document.getElementById('unlockedPlotCount').textContent = `å¯ç”¨åœ°å—: ${gameState.unlockedPlots}/${gameState.maxPlots}`;
    }
    
    // ===== æ¸²æŸ“ç»Ÿè®¡ä¿¡æ¯ =====
    function renderStats() {
      const currentLevelCfg = LEVEL_CONFIG.find(cfg => cfg.level === gameState.level) || LEVEL_CONFIG[0];
      
      document.getElementById('level').textContent = gameState.level;
      document.getElementById('exp').textContent = gameState.exp;
      document.getElementById('nextLevelExp').textContent = currentLevelCfg.nextExp || 'MAX';
      document.getElementById('plantedCount').textContent = gameState.totalPlanted;
      
      // é‡‘å¸æ•°å­—åŠ¨ç”»
      const goldEl = document.getElementById('gold');
      goldEl.textContent = gameState.gold;
      goldEl.classList.add('animate');
      setTimeout(() => goldEl.classList.remove('animate'), 500);
      
      document.getElementById('pesticide').textContent = gameState.pesticide;
      document.getElementById('fertilizer').textContent = gameState.fertilizer;
      
      // æ›´æ–°ç§°å·
      updatePlantTitle();
      updateGoldTitle();
    }
    
    // ===== æ¸²æŸ“ç§å­ä»“åº“ =====
    function renderSeedInventory() {
      const inventoryEl = document.getElementById('seedInventory');
      inventoryEl.innerHTML = '';
      
      for (const [crop, count] of Object.entries(gameState.seeds)) {
        if (count <= 0) continue;
        
        const seedCard = document.createElement('div');
        seedCard.className = `seed-card ${selectedSeed === crop ? 'selected' : ''}`;
        seedCard.innerHTML = `
          ${CROPS[crop]?.icon || 'ğŸŒ±'} ${crop}
          <div class="seed-count">Ã—${count}</div>
        `;
        
        seedCard.onclick = () => {
          selectedSeed = crop;
          document.querySelectorAll('.seed-card').forEach(card => {
            card.classList.remove('selected');
          });
          seedCard.classList.add('selected');
          document.getElementById('selectedSeedDisplay').textContent = crop;
          notify(`å·²é€‰æ‹©${crop}ç§å­ï¼Œç‚¹å‡»ç©ºåœ°å³å¯ç§æ¤`, 'info', 'é€‰æ‹©ç§å­');
        };
        
        inventoryEl.appendChild(seedCard);
      }
    }
    
    // ===== æ¸²æŸ“å†œç”° =====
    function renderField() {
      const farmEl = document.getElementById('farm-land');
      farmEl.innerHTML = '';
      
      const landLevel = LAND_LEVELS[gameState.landLevel];
      const currentTime = Date.now();
      
      gameState.lands.farm.forEach((plot, index) => {
        const plotEl = document.createElement('div');
        plotEl.className = 'plot';
        
        // é”å®š/è§£é”çŠ¶æ€
        if (index >= gameState.unlockedPlots) {
          plotEl.classList.add('locked');
          plotEl.innerHTML = `ğŸ”’<br>ç­‰çº§${getLevelForPlot(index)}çº§è§£é”`;
          farmEl.appendChild(plotEl);
          return;
        }
        
        // ç©ºåœ°å—
        if (!plot.crop) {
          plotEl.classList.add('empty', landLevel.color);
          plotEl.innerHTML = `<div class="plot-content">${landLevel.name}<br>ç‚¹å‡»ç§æ¤</div>`;
          
          plotEl.onclick = () => {
            if (!selectedSeed || gameState.seeds[selectedSeed] <= 0) {
              notify('è¯·å…ˆé€‰æ‹©æœ‰æ•ˆçš„ç§å­ï¼', 'warning', 'ç§æ¤å¤±è´¥');
              plotEl.classList.add('shake');
              setTimeout(() => plotEl.classList.remove('shake'), 500);
              return;
            }
            
            // æ¶ˆè€—ç§å­
            gameState.seeds[selectedSeed]--;
            if (gameState.seeds[selectedSeed] < 0) gameState.seeds[selectedSeed] = 0;
            
            // ç§æ¤ä½œç‰©
            plot.crop = selectedSeed;
            plot.plantedAt = currentTime;
            plot.lastWatered = currentTime;
            plot.wiltedAt = null;
            plot.infestedAt = null;
            plot.totalInfestedTime = 0;
            plot.totalWiltedTime = 0;
            plot.infestedStartTime = null;
            plot.wiltedStartTime = null;
            plot.hasEverBeenInfested = false;
            plot.hasEverBeenWilted = false;
            plot.fertilized = false;
            
            // æ›´æ–°ç»Ÿè®¡
            gameState.totalPlanted++;
            
            // å¢åŠ ç»éªŒ
            addExp(5);
            
            // æ›´æ–°UI
            renderField();
            renderSeedInventory();
            renderStats();
            
            notify(`${CROPS[selectedSeed].icon} æˆåŠŸç§æ¤${selectedSeed}ï¼`, 'success', 'ç§æ¤æˆåŠŸ');
          };
          
          farmEl.appendChild(plotEl);
          return;
        }
        
        // æœ‰ä½œç‰©çš„åœ°å—
        const cropInfo = CROPS[plot.crop];
        const growthTime = cropInfo.growthTime * landLevel.timeRate;
        const elapsed = currentTime - plot.plantedAt - (plot.fertilized ? growthTime * 0.1 : 0);
        const remaining = Math.max(0, growthTime - elapsed);
        
        // çŠ¶æ€åˆ¤æ–­
        let status = 'growing';
        let statusIcon = '';
        let statusText = '';
        
        // è®¡ç®—ç¾å®³æ—¶é—´
        if (plot.infestedAt && !plot.wiltedAt) {
          if (!plot.infestedStartTime) plot.infestedStartTime = currentTime;
          plot.totalInfestedTime += currentTime - plot.infestedAt;
          plot.infestedAt = currentTime;
          plot.hasEverBeenInfested = true;
          
          if (plot.totalInfestedTime > 5000) { // è™«å®³5ç§’æ¯è
            plot.wiltedAt = currentTime;
            if (!plot.wiltedStartTime) plot.wiltedStartTime = currentTime;
            plot.totalWiltedTime += currentTime - plot.wiltedAt;
            plot.hasEverBeenWilted = true;
          } else {
            status = 'infested';
            statusIcon = '<div class="status-icon infested">ğŸ›</div>';
            statusText = 'è™«å®³ï¼';
          }
        }
        
        if (plot.wiltedAt) {
          if (!plot.wiltedStartTime) plot.wiltedStartTime = currentTime;
          plot.totalWiltedTime += currentTime - plot.wiltedAt;
          plot.wiltedAt = currentTime;
          plot.hasEverBeenWilted = true;
          
          status = 'wilted';
          statusIcon = '<div class="status-icon wilted">ğŸ’€</div>';
          statusText = 'æ¯èï¼';
        } else if (remaining <= 0) {
          status = 'mature';
          statusIcon = '<div class="status-icon">ğŸ</div>';
          statusText = 'å¯æ”¶è·ï¼';
        } else {
          // æ£€æŸ¥å¹²æ—±
          const waterElapsed = currentTime - plot.lastWatered;
          if (waterElapsed > 10000 && currentWeather.effect === 'drought') { // å¹²æ—±å¤©æ°”10ç§’ç¼ºæ°´
            statusIcon = '<div class="status-icon dehydrated">ğŸ’§</div>';
            statusText = 'ç¼ºæ°´ï¼';
          }
        }
        
        // è®¾ç½®åœ°å—æ ·å¼
        plotEl.classList.add(status, landLevel.color);
        
        // è®¡ç®—äº§é‡ï¼ˆå—åœŸåœ°ç­‰çº§å’Œç¾å®³å½±å“ï¼‰
        let yieldMultiplier = landLevel.rewardRate;
        if (plot.hasEverBeenInfested) yieldMultiplier *= 0.8;
        if (plot.hasEverBeenWilted) yieldMultiplier *= 0.5;
        const finalReward = Math.floor(cropInfo.reward * yieldMultiplier);
        
        // åœ°å—å†…å®¹
        plotEl.innerHTML = `
          <div class="plot-content">
            <div class="crop-icon-container">
              ${cropInfo.icon}
              ${statusIcon}
            </div>
            ${plot.crop}
            <div class="time-label">${formatTime(remaining)}</div>
            ${statusText ? `<div class="yield-info">${statusText}</div>` : ''}
            <div class="yield-info">é¢„è®¡æ”¶ç›Š: ${finalReward}é‡‘å¸</div>
            <div class="plot-button-container">
              ${status === 'infested' ? `<button class="plot-button spray" onclick="sprayPlot(${index})">ğŸ› æ€è™«</button>` : ''}
              ${status.includes('wilted') ? '' : `<button class="plot-button water" onclick="waterPlot(${index})">ğŸ’§ æµ‡æ°´</button>`}
              ${!plot.fertilized && status !== 'mature' && status !== 'wilted' ? `<button class="plot-button fertilize" onclick="fertilizePlot(${index})">ğŸŒ± æ–½è‚¥</button>` : ''}
              ${status === 'mature' ? `<button class="plot-button" onclick="harvestPlot(${index})">ğŸ¯ æ”¶è·</button>` : ''}
            </div>
          </div>
        `;
        
        farmEl.appendChild(plotEl);
      });
      
      // å¤©æ°”æ•ˆæœå¤„ç†
      if (currentWeather.effect === 'pest_outbreak') {
        // è™«ç¾ï¼šéšæœºè®©5%çš„åœ°å—ç”Ÿè™«
        const infestChance = 0.05;
        gameState.lands.farm.forEach((plot, index) => {
          if (index < gameState.unlockedPlots && plot.crop && !plot.infestedAt && !plot.wiltedAt && Math.random() < infestChance) {
            plot.infestedAt = currentTime;
            notify(`ğŸ› è™«ç¾æ¥è¢­ï¼${plot.crop}åœ°å—å‘ç”Ÿè™«å®³ï¼`, 'warning', 'è™«ç¾é¢„è­¦');
          }
        });
      } else if (currentWeather.effect === 'drought') {
        // å¹²æ—±ï¼šå¢åŠ ç¼ºæ°´é€Ÿåº¦
        notify(`ğŸŒ å¹²æ—±å¤©æ°”ï¼ä½œç‰©ç¼ºæ°´é€Ÿåº¦åŠ å¿«ï¼`, 'warning', 'å¹²æ—±é¢„è­¦');
      } else if (currentWeather.effect === 'rain') {
        // é›¨å¤©ï¼šè‡ªåŠ¨æµ‡æ°´
        gameState.lands.farm.forEach((plot, index) => {
          if (index < gameState.unlockedPlots && plot.crop) {
            plot.lastWatered = currentTime;
          }
        });
        notify(`ğŸŒ§ï¸ å¤©é™ç”˜éœ–ï¼æ‰€æœ‰ä½œç‰©å·²æµ‡æ°´ï¼`, 'success', 'é›¨å¤©ç¦åˆ©');
      }
    }
    
    // ===== è¾…åŠ©å‡½æ•°ï¼šè·å–è§£é”åœ°å—æ‰€éœ€ç­‰çº§ =====
    function getLevelForPlot(plotIndex) {
      for (let i = LEVEL_CONFIG.length - 1; i >= 0; i--) {
        if (plotIndex < LEVEL_CONFIG[i].unlockPlots) {
          return LEVEL_CONFIG[i].level;
        }
      }
      return LEVEL_CONFIG[LEVEL_CONFIG.length - 1].level;
    }
    
    // ===== åœ°å—æ“ä½œå‡½æ•° =====
    function harvestPlot(index) {
      const plot = gameState.lands.farm[index];
      if (!plot.crop) return;
      
      const currentTime = Date.now();
      const cropInfo = CROPS[plot.crop];
      const landLevel = LAND_LEVELS[gameState.landLevel];
      
      // è®¡ç®—äº§é‡
      let yieldMultiplier = landLevel.rewardRate;
      if (plot.hasEverBeenInfested) yieldMultiplier *= 0.8;
      if (plot.hasEverBeenWilted) yieldMultiplier *= 0.5;
      const finalReward = Math.floor(cropInfo.reward * yieldMultiplier);
      
      // æ”¶è·å¥–åŠ±
      gameState.gold += finalReward;
      gameState.totalEarnedGold += finalReward;
      gameState.totalHarvest++;
      
      // å¢åŠ ç»éªŒ
      addExp(10);
      
      // æ¸…ç©ºåœ°å—
      plot.crop = null;
      plot.plantedAt = null;
      plot.lastWatered = null;
      plot.wiltedAt = null;
      plot.infestedAt = null;
      plot.totalInfestedTime = 0;
      plot.totalWiltedTime = 0;
      plot.infestedStartTime = null;
      plot.wiltedStartTime = null;
      plot.hasEverBeenInfested = false;
      plot.hasEverBeenWilted = false;
      plot.fertilized = false;
      
      // æ›´æ–°UI
      renderField();
      renderStats();
      
      // æˆç†Ÿé€šçŸ¥ï¼ˆå¸¦éœ‡åŠ¨ï¼‰
      notify(`${cropInfo.icon} æ”¶è·${plot.crop}Ã—1ï¼è·å¾—${finalReward}é‡‘å¸
å½“å‰åœŸåœ°ç­‰çº§åŠ æˆï¼šÃ—${landLevel.rewardRate}
ç¾å®³å½±å“ï¼š${plot.hasEverBeenInfested ? 'è™«å®³(-20%)' : ''}${plot.hasEverBeenWilted ? 'æ¯è(-50%)' : ''}`, 
             'mature', 'æ”¶è·æˆåŠŸ');
    }
    
    function waterPlot(index) {
      const plot = gameState.lands.farm[index];
      if (!plot.crop || plot.wiltedAt) return;
      
      plot.lastWatered = Date.now();
      notify(`ğŸ’§ å·²ä¸º${plot.crop}æµ‡æ°´ï¼`, 'success', 'æµ‡æ°´æˆåŠŸ');
      renderField();
    }
    
    function sprayPlot(index) {
      const plot = gameState.lands.farm[index];
      if (!plot.crop || !plot.infestedAt || gameState.pesticide <= 0) {
        if (gameState.pesticide <= 0) notify('æ€è™«å‰‚ä¸è¶³ï¼', 'error', 'æ€è™«å¤±è´¥');
        return;
      }
      
      gameState.pesticide--;
      plot.infestedAt = null;
      plot.infestedStartTime = null;
      notify(`ğŸ› å·²ä¸º${plot.crop}æ€è™«ï¼å‰©ä½™æ€è™«å‰‚ï¼š${gameState.pesticide}`, 'success', 'æ€è™«æˆåŠŸ');
      
      renderStats();
      renderField();
    }
    
    function fertilizePlot(index) {
      const plot = gameState.lands.farm[index];
      if (!plot.crop || plot.fertilized || plot.wiltedAt || gameState.fertilizer <= 0) {
        if (gameState.fertilizer <= 0) notify('è‚¥æ–™ä¸è¶³ï¼', 'error', 'æ–½è‚¥å¤±è´¥');
        return;
      }
      
      gameState.fertilizer--;
      plot.fertilized = true;
      notify(`ğŸŒ± å·²ä¸º${plot.crop}æ–½è‚¥ï¼ç”Ÿé•¿é€Ÿåº¦+10%ï¼Œå‰©ä½™è‚¥æ–™ï¼š${gameState.fertilizer}`, 'success', 'æ–½è‚¥æˆåŠŸ');
      
      renderStats();
      renderField();
    }
    
    // ===== æ‰¹é‡æ“ä½œå‡½æ•° =====
    function harvestAll() {
      let harvestedCount = 0;
      let totalGold = 0;
      
      gameState.lands.farm.forEach((plot, index) => {
        if (index < gameState.unlockedPlots && plot.crop) {
          const currentTime = Date.now();
          const cropInfo = CROPS[plot.crop];
          const landLevel = LAND_LEVELS[gameState.landLevel];
          const growthTime = cropInfo.growthTime * landLevel.timeRate;
          const elapsed = currentTime - plot.plantedAt - (plot.fertilized ? growthTime * 0.1 : 0);
          const remaining = Math.max(0, growthTime - elapsed);
          
          if (remaining <= 0) {
            // è®¡ç®—äº§é‡
            let yieldMultiplier = landLevel.rewardRate;
            if (plot.hasEverBeenInfested) yieldMultiplier *= 0.8;
            if (plot.hasEverBeenWilted) yieldMultiplier *= 0.5;
            const finalReward = Math.floor(cropInfo.reward * yieldMultiplier);
            
            // æ”¶è·å¥–åŠ±
            gameState.gold += finalReward;
            gameState.totalEarnedGold += finalReward;
            gameState.totalHarvest++;
            totalGold += finalReward;
            
            // æ¸…ç©ºåœ°å—
            plot.crop = null;
            plot.plantedAt = null;
            plot.lastWatered = null;
            plot.wiltedAt = null;
            plot.infestedAt = null;
            plot.totalInfestedTime = 0;
            plot.totalWiltedTime = 0;
            plot.infestedStartTime = null;
            plot.wiltedStartTime = null;
            plot.hasEverBeenInfested = false;
            plot.hasEverBeenWilted = false;
            plot.fertilized = false;
            
            harvestedCount++;
          }
        }
      });
      
      if (harvestedCount > 0) {
        // å¢åŠ ç»éªŒ
        addExp(harvestedCount * 5);
        
        notify(`ğŸšœ ä¸€é”®æ”¶è·æˆåŠŸï¼
æ”¶è·ä½œç‰©Ã—${harvestedCount}
è·å¾—é‡‘å¸Ã—${totalGold}`, 'success', 'æ‰¹é‡æ”¶è·');
        
        renderField();
        renderStats();
      } else {
        notify('æš‚æ— å¯æ”¶è·çš„ä½œç‰©ï¼', 'warning', 'æ‰¹é‡æ”¶è·');
      }
    }
    
    function waterAll() {
      let wateredCount = 0;
      
      gameState.lands.farm.forEach((plot, index) => {
        if (index < gameState.unlockedPlots && plot.crop && !plot.wiltedAt) {
          plot.lastWatered = Date.now();
          wateredCount++;
        }
      });
      
      if (wateredCount > 0) {
        notify(`ğŸ’§ ä¸€é”®æµ‡æ°´æˆåŠŸï¼å·²ä¸º${wateredCount}å—ä½œç‰©æµ‡æ°´`, 'success', 'æ‰¹é‡æµ‡æ°´');
        renderField();
      } else {
        notify('æš‚æ— éœ€è¦æµ‡æ°´çš„ä½œç‰©ï¼', 'warning', 'æ‰¹é‡æµ‡æ°´');
      }
    }
    
    function sprayAll() {
      if (gameState.pesticide <= 0) {
        notify('æ€è™«å‰‚ä¸è¶³ï¼', 'error', 'æ‰¹é‡æ€è™«');
        return;
      }
      
      let sprayedCount = 0;
      
      gameState.lands.farm.forEach((plot, index) => {
        if (index < gameState.unlockedPlots && plot.crop && plot.infestedAt && !plot.wiltedAt) {
          plot.infestedAt = null;
          plot.infestedStartTime = null;
          sprayedCount++;
        }
      });
      
      if (sprayedCount > 0) {
        gameState.pesticide -= sprayedCount;
        if (gameState.pesticide < 0) gameState.pesticide = 0;
        
        notify(`ğŸ› ä¸€é”®æ€è™«æˆåŠŸï¼
å·²ä¸º${sprayedCount}å—ä½œç‰©æ€è™«
å‰©ä½™æ€è™«å‰‚ï¼š${gameState.pesticide}`, 'success', 'æ‰¹é‡æ€è™«');
        
        renderStats();
        renderField();
      } else {
        notify('æš‚æ— éœ€è¦æ€è™«çš„ä½œç‰©ï¼', 'warning', 'æ‰¹é‡æ€è™«');
      }
    }
    
    function fertilizeAll() {
      if (gameState.fertilizer <= 0) {
        notify('è‚¥æ–™ä¸è¶³ï¼', 'error', 'æ‰¹é‡æ–½è‚¥');
        return;
      }
      
      let fertilizedCount = 0;
      
      gameState.lands.farm.forEach((plot, index) => {
        if (index < gameState.unlockedPlots && plot.crop && !plot.fertilized && !plot.wiltedAt) {
          plot.fertilized = true;
          fertilizedCount++;
        }
      });
      
      if (fertilizedCount > 0) {
        gameState.fertilizer -= fertilizedCount;
        if (gameState.fertilizer < 0) gameState.fertilizer = 0;
        
        notify(`ğŸŒ± ä¸€é”®æ–½è‚¥æˆåŠŸï¼
å·²ä¸º${fertilizedCount}å—ä½œç‰©æ–½è‚¥
å‰©ä½™è‚¥æ–™ï¼š${gameState.fertilizer}`, 'success', 'æ‰¹é‡æ–½è‚¥');
        
        renderStats();
        renderField();
      } else {
        notify('æš‚æ— éœ€è¦æ–½è‚¥çš„ä½œç‰©ï¼', 'warning', 'æ‰¹é‡æ–½è‚¥');
      }
    }
    
    // ===== å•†åº—è´­ä¹°å‡½æ•° =====
    function buySeed(crop, price) {
      if (gameState.gold < price) {
        notify(`é‡‘å¸ä¸è¶³ï¼è´­ä¹°${crop}ç§å­éœ€è¦${price}é‡‘å¸`, 'error', 'è´­ä¹°å¤±è´¥');
        return;
      }
      
      gameState.gold -= price;
      if (!gameState.seeds[crop]) gameState.seeds[crop] = 0;
      gameState.seeds[crop]++;
      
      notify(`${CROPS[crop].icon} æˆåŠŸè´­ä¹°${crop}ç§å­Ã—1ï¼`, 'success', 'è´­ä¹°æˆåŠŸ');
      
      renderStats();
      renderSeedInventory();
    }
    
    function buyItem(itemType, price) {
      if (gameState.gold < price) {
        notify(`é‡‘å¸ä¸è¶³ï¼è´­ä¹°${itemType === 'pesticide' ? 'æ€è™«å‰‚' : 'è‚¥æ–™'}éœ€è¦${price}é‡‘å¸`, 'error', 'è´­ä¹°å¤±è´¥');
        return;
      }
      
      gameState.gold -= price;
      if (itemType === 'pesticide') {
        gameState.pesticide++;
        notify(`ğŸ› æˆåŠŸè´­ä¹°æ€è™«å‰‚Ã—1ï¼å‰©ä½™ï¼š${gameState.pesticide}`, 'success', 'è´­ä¹°æˆåŠŸ');
      } else {
        gameState.fertilizer++;
        notify(`ğŸŒ± æˆåŠŸè´­ä¹°è‚¥æ–™Ã—1ï¼å‰©ä½™ï¼š${gameState.fertilizer}`, 'success', 'è´­ä¹°æˆåŠŸ');
      }
      
      renderStats();
    }
    
    // ===== å­˜æ¡£å‡½æ•° =====
    function saveGame() {
      try {
        localStorage.setItem(SAVE_KEY, JSON.stringify(gameState));
        notify('ğŸ’¾ æ¸¸æˆå­˜æ¡£å·²ä¿å­˜ï¼', 'success', 'å­˜æ¡£æˆåŠŸ');
      } catch (e) {
        notify('âŒ å­˜æ¡£å¤±è´¥ï¼š' + e.message, 'error', 'å­˜æ¡£å¤±è´¥');
      }
    }
    
    function loadGame() {
      try {
        const saved = localStorage.getItem(SAVE_KEY);
        if (!saved) {
          notify('âš ï¸ æš‚æ— å­˜æ¡£æ•°æ®ï¼', 'warning', 'è¯»å–å¤±è´¥');
          return;
        }
        
        const loadedState = JSON.parse(saved);
        if (loadedState && typeof loadedState.gold === 'number') {
          gameState = {
            ...gameState,
            ...loadedState,
            lands: {
              farm: loadedState.lands?.farm || initPlots(50)
            },
            checkInRecords: loadedState.checkInRecords || [],
            lastCheckInDate: loadedState.lastCheckInDate || '',
            consecutiveCheckInDays: loadedState.consecutiveCheckInDays || 0,
            hasSeenGuide: loadedState.hasSeenGuide || false
          };
          
          // å…¼å®¹æ—§å­˜æ¡£çš„åœŸåœ°ç­‰çº§
          if (typeof gameState.landLevel !== 'number') gameState.landLevel = 0;
          
          notify('ğŸ“¤ æ¸¸æˆå­˜æ¡£å·²åŠ è½½ï¼', 'success', 'è¯»å–æˆåŠŸ');
          
          // æ›´æ–°æ‰€æœ‰UI
          renderStats();
          renderSeedInventory();
          renderField();
          updateUnlockedPlotCount();
          updateLandLevelDisplay();
          updateCheckInUI();
          updatePlantTitle();
          updateGoldTitle();
        }
      } catch (e) {
        notify('âŒ è¯»å–å¤±è´¥ï¼šå­˜æ¡£æŸåï¼', 'error', 'è¯»å–å¤±è´¥');
      }
    }
    
    function clearSave() {
      if (confirm('ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰å­˜æ¡£æ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) {
        localStorage.removeItem(SAVE_KEY);
        // é‡ç½®æ¸¸æˆçŠ¶æ€
        gameState = {
          level: 1,
          exp: 0,
          gold: 200,
          pesticide: 5,
          fertilizer: 5,
          seeds: { å°éº¦: 10, ç‰ç±³: 8, åœŸè±†: 6, ç•ªèŒ„: 4, å‘æ—¥è‘µ: 2 },
          totalHarvest: 0,
          totalPlanted: 0,
          totalEarnedGold: 200,
          lands: {
            farm: initPlots(50)
          },
          unlockedPlots: 10,
          maxPlots: 50,
          landLevel: 0,
          checkInRecords: [],
          lastCheckInDate: '',
          consecutiveCheckInDays: 0,
          hasSeenGuide: true // æ¸…é™¤å­˜æ¡£åä¸å†æ˜¾ç¤ºæ–°æ‰‹å¼•å¯¼
        };
        
        notify('ğŸ—‘ï¸ å­˜æ¡£å·²æ¸…é™¤ï¼Œæ¸¸æˆå·²é‡ç½®ï¼', 'success', 'æ¸…é™¤æˆåŠŸ');
        
        // æ›´æ–°æ‰€æœ‰UI
        renderStats();
        renderSeedInventory();
        renderField();
        updateUnlockedPlotCount();
        updateLandLevelDisplay();
        updateCheckInUI();
        updatePlantTitle();
        updateGoldTitle();
      }
    }
    
    // ===== åˆå§‹åŒ–å‡½æ•° =====
    function initGame() {
      // æ˜¾ç¤ºæ–°æ‰‹å¼•å¯¼
      if (!gameState.hasSeenGuide) {
        document.getElementById('guideModal').style.display = 'flex';
        gameState.hasSeenGuide = true;
      }
      
      // ç»‘å®šæ‰©åœ°å’Œå‡çº§æŒ‰é’®
      document.getElementById('expandLandBtn').onclick = expandLand;
      document.getElementById('upgradeLandBtn').onclick = upgradeLand;
      document.getElementById('checkinBtn').onclick = checkIn;
      
      // åˆå§‹åŒ–UI
      renderStats();
      renderSeedInventory();
      renderField();
      updateUnlockedPlotCount();
      updateLandLevelDisplay();
      updateCheckInUI();
      
      // å®šæ—¶æ›´æ–°ä½œç‰©çŠ¶æ€ï¼ˆæ¯ç§’ï¼‰
      setInterval(() => {
        renderField();
        
        // æ£€æŸ¥æˆç†Ÿä½œç‰©å¹¶å‘é€é€šçŸ¥
        const currentTime = Date.now();
        const landLevel = LAND_LEVELS[gameState.landLevel];
        
        gameState.lands.farm.forEach((plot, index) => {
          if (index < gameState.unlockedPlots && plot.crop) {
            const cropInfo = CROPS[plot.crop];
            const growthTime = cropInfo.growthTime * landLevel.timeRate;
            const elapsed = currentTime - plot.plantedAt - (plot.fertilized ? growthTime * 0.1 : 0);
            const remaining = Math.max(0, growthTime - elapsed);
            
            if (remaining <= 0 && !plot._matureNotified) {
              plot._matureNotified = true;
              notify(`${cropInfo.icon} ${plot.crop}å·²æˆç†Ÿï¼è¯·åŠæ—¶æ”¶è·ï¼`, 'mature', 'ä½œç‰©æˆç†Ÿæé†’');
            } else if (remaining > 0) {
              plot._matureNotified = false;
            }
          }
        });
      }, 1000);
      
      // è‡ªåŠ¨ä¿å­˜ï¼ˆ5åˆ†é’Ÿä¸€æ¬¡ï¼‰
      setInterval(saveGame, 300000);
      
      notify('ğŸŒ¾ æåŒ—é˜³å…‰æ¤ç‰©ç§æ¤å›­é€Ÿæˆç‰ˆå·²åŠ è½½å®Œæˆï¼', 'success', 'æ¸¸æˆåˆå§‹åŒ–');
    }
    
    // å¯åŠ¨æ¸¸æˆ
    window.onload = initGame;
  </script>
</body>
</html>